const fromText=document.querySelector(".from-text"),toText=document.querySelector(".to-text"),exchageIcon=document.querySelector(".exchange"),selectTags=document.querySelectorAll("select"),translateBtn=document.getElementById("translate-btn"),uploadBtn=document.getElementById("upload-btn"),pdfUpload=document.getElementById("pdf-upload"),fileName=document.getElementById("file-name"),downloadPdfBtn=document.getElementById("download-pdf"),progressContainer=document.getElementById("progress-container"),progressBar=document.getElementById("progress-bar"),progressText=document.getElementById("progress-text");let pdfTextContent="",translatedPdfText="",pdfFile=null;async function translateText(e,t,n){const o=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(e)}&langpair=${t}|${n}`,a=await fetch(o),r=await a.json();if(r.responseData)return r.responseData.translatedText;throw new Error(r.responseDetails||"Translation failed")}async function translateLargeText(e,t,n){const o=[];for(let t=0;t<e.length;t+=5e3)o.push(e.substring(t,t+5e3));progressContainer.style.display="block",progressBar.style.width="0%",progressText.textContent="0%";let a=[];for(let e=0;e<o.length;e++)try{const r=await translateText(o[e],t,n);a.push(r);const s=Math.round((e+1)/o.length*100);progressBar.style.width=`${s}%`,progressText.textContent=`${s}%`,toText.value=a.join(""),await new Promise((e=>setTimeout(e,500)))}catch(t){console.error(`Error translating chunk ${e+1}:`,t),a.push(`[Translation error in chunk ${e+1}]`)}return progressContainer.style.display="none",a.join("")}async function translateText(e,t,n){if(e.length<=500){const o=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(e)}&langpair=${t}|${n}`,a=await fetch(o),r=await a.json();return r.responseData?.translatedText||e}const o=splitTextIntoChunks(e,450);let a="";progressContainer.style.display="block",progressBar.style.width="0%",progressText.textContent="0%";for(let e=0;e<o.length;e++)try{const r=o[e],s=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(r)}&langpair=${t}|${n}`,l=await fetch(s),d=await l.json();d.responseData?a+=d.responseData.translatedText+" ":a+=r+" ";const i=Math.round((e+1)/o.length*100);progressBar.style.width=`${i}%`,progressText.textContent=`${i}%`,await new Promise((e=>setTimeout(e,300)))}catch(t){console.error(`Error translating chunk ${e+1}:`,t)}return progressContainer.style.display="none",a}function splitTextIntoChunks(e,t){const n=[],o=e.split(/(?<=[.!?])\s+/);let a="";for(const e of o)a.length+e.length>t?(a&&n.push(a),a=e):a+=(a?" ":"")+e;return a&&n.push(a),n}async function extractTextFromPdf(e){return new Promise(((t,n)=>{const o=new FileReader;o.onload=async function(){try{const e=new Uint8Array(this.result),n=await pdfjsLib.getDocument(e).promise;let o="";for(let e=1;e<=n.numPages;e++){const t=await n.getPage(e),a=await t.getTextContent();if(o+=a.items.map((e=>e.str)).join(" ")+"\n\n",n.numPages>5){const t=Math.round(e/n.numPages*100);progressBar.style.width=`${t}%`,progressText.textContent=`${t}%`,progressContainer.style.display="block"}}progressContainer.style.display="none",t(o)}catch(e){n(e)}},o.onerror=n,o.readAsArrayBuffer(e)}))}function showTooltip(e,t){const n=document.createElement("div");n.className="tooltip",n.textContent=t;const o=e.getBoundingClientRect();n.style.left=`${o.left+o.width/2}px`,n.style.top=o.top-30+"px",document.body.appendChild(n),setTimeout((()=>{n.classList.add("fade-out"),setTimeout((()=>{document.body.removeChild(n)}),500)}),1500)}selectTags.forEach(((e,t)=>{for(const n in countries){const o=`<option ${0===t?"en-GB"===n?"selected":"":"hi-IN"===n?"selected":""} value="${n}">${countries[n]}</option>`;e.insertAdjacentHTML("beforeend",o)}})),exchageIcon.addEventListener("click",(()=>{const e=fromText.value,t=selectTags[0].value;fromText.value=toText.value,toText.value=e,selectTags[0].value=selectTags[1].value,selectTags[1].value=t})),document.getElementById("clear-from").addEventListener("click",(()=>{fromText.value=""})),document.getElementById("clear-to").addEventListener("click",(()=>{toText.value=""})),translateBtn.addEventListener("click",(async()=>{const e=fromText.value.trim(),t=selectTags[0].value,n=selectTags[1].value;if(e||pdfTextContent){toText.setAttribute("placeholder","Translating..."),toText.value="";try{const o=pdfTextContent||e;if(o.length>5e3)await translateLargeText(o,t,n);else{const e=await translateText(o,t,n);toText.value=e}pdfTextContent&&(translatedPdfText=toText.value,downloadPdfBtn.disabled=!1)}catch(e){console.error("Translation error:",e),toText.value="Translation failed. Please try again."}finally{toText.setAttribute("placeholder","Translation")}}else alert("Please enter text or upload a PDF file to translate")})),uploadBtn.addEventListener("click",(()=>{pdfUpload.click()})),pdfUpload.addEventListener("change",(async e=>{const t=e.target.files[0];if(t){pdfFile=t,fileName.textContent=t.name,fromText.value="",toText.value="",downloadPdfBtn.disabled=!0;try{fromText.setAttribute("placeholder","Extracting text from PDF..."),pdfTextContent=await extractTextFromPdf(t),fromText.value=pdfTextContent,fromText.setAttribute("placeholder","Enter text or upload PDF")}catch(e){console.error("PDF extraction error:",e),fromText.setAttribute("placeholder","PDF extraction failed"),fileName.textContent="Error processing PDF"}}})),downloadPdfBtn.addEventListener("click",(async()=>{if(translatedPdfText&&pdfFile)try{downloadPdfBtn.disabled=!0,downloadPdfBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Generating PDF...';const e=new Blob([translatedPdfText],{type:"text/plain"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download=`translated_${pdfFile.name.replace(".pdf","")}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}catch(e){console.error("PDF download error:",e),alert("Failed to generate PDF download")}finally{downloadPdfBtn.disabled=!1,downloadPdfBtn.innerHTML='<i class="fas fa-file-download"></i> Download Translated PDF'}else alert("No translated content available")})),document.querySelectorAll(".icons i").forEach((e=>{e.addEventListener("click",(({target:e})=>{if(e.classList.contains("fa-copy")){const t="from"===e.id?fromText.value:toText.value;t&&(navigator.clipboard.writeText(t),showTooltip(e,"Copied!"))}else if(e.classList.contains("fa-volume-up")){const t="from"===e.id?fromText.value:toText.value,n="from"===e.id?selectTags[0].value:selectTags[1].value;if(t){const o=new SpeechSynthesisUtterance(t);o.lang=n,speechSynthesis.speak(o),showTooltip(e,"Speaking...")}}}))}));